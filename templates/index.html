<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>EEG Emotion Recognition</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container">
        <a class="navbar-brand" href="#">EEG Emotion Recognition</a>
        <div class="navbar-nav">
          <a class="nav-link active" href="/">Home</a>
          <a class="nav-link" href="/about-us">About Us</a>
        </div>
      </div>
    </nav>
    <div class="sidebar">
      <h4>Upload History</h4>
      <div id="uploadHistory">
          <!-- Dynamically populated history items will go here -->
      </div>
    </div>
    <div class="container my-5">
      <div class="section mb-3" id="signalUploadBox">
        <h2>Input Signal Section</h2>
        <span id="statusMessage">Selected file name...</span>
        <br>
        <input type="file" id="file-upload" hidden onchange="uploadFile()" />
        <label for="file-upload" class="btn btn-primary">Upload Signal</label>
      </div>

      <div class="graph-view mb-3">
        <h2>Input Signal Graph View</h2>
        <div id="graph-placeholder">
          <div id="chart"></div>
        </div>
        <!-- Plotly will render the graph here -->
        <div class="d-flex justify-content-left mt-3">
          <button class="btn btn-primary" onclick="classifyEmotion()">Classify Emotion</button>
        </div>
      </div>

      <div class="emotion-state mb-3" >
        <h2>Classified Emotion State</h2>
        <img id="predictionImg"></img>
        <div id="classifiedEmotion">classified emotion</div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <script>

      function uploadFile() {
        var fileInput = document.getElementById("file-upload");
        var file = fileInput.files[0];
        var formData = new FormData();
        formData.append("file", file);

        fetch("/upload", {
            method: "POST",
            body: formData,
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');  // This will send the code to the .catch block
            }
            return response.text();
        })
        .then(data => {
        alert("File uploaded successfully!");
        const parsedData = JSON.parse(data)
        console.log((parsedData)); // Check the received data
        Plotly.newPlot('chart', JSON.parse(data).data, JSON.parse(data).layout);
        document.getElementById("statusMessage").textContent = "EEG Signal Uploaded Successfully!";
        })
        .catch(error => {
            console.error("Error:", error);
            alert("An error occurred while uploading the EEG file");
        });


        }

        function showFileName() {
        var input = document.getElementById("file-upload");
        print(input)
        if (input.files && input.files[0]) {
            var fileName = input.files[0].name;
            document.getElementById("file-name").textContent = fileName;
        } else {
            document.getElementById("file-name").textContent = "No file chosen...";
        }
        }

        function classifyEmotion(){
            fetch("/classify", {
                method: "POST",
            })
            .then(response => {
            if (!response.ok) {
                throw new Error('Classification failed');  // This will send the code to the .catch block
            }
            return response.text();
            })
            .then(predictedEmotion => {
              console.log(predictedEmotion)
                // alert(data);
                const emotionText = document.getElementById("classifiedEmotion")
                document.getElementById("classifiedEmotion").textContent = predictedEmotion;
                // let img = new Image();
                const image = document.getElementById('predictionImg')
                image.src = `../static/${predictedEmotion}.png`;
                image.style.height="100px";
                image.style.width="100px";
                // img.src =
                    // `./emojis/${predictedEmotion}.png`;
                // document.getElementById('predictionImg').appendChild(img);
                // console.log(`/Users/eshan/Documents/Uni/Year 4/FYP/EEG Implementation/Flask/emojis/${predictedEmotion}.png`)
                // console.log("img", img)
                // console.log("emotionText", emotionText)
            
            })
        }

      //   function displayGraph(graphJSON) {
      //     var graphData = JSON.parse(graphJSON);
      //     Plotly.newPlot("graph-placeholder", graphData.data, graphData.layout);
      //   }
    </script>
  </body>
</html>
